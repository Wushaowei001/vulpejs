angular.module("dndLists",[]).directive("dndDraggable",["$parse","$timeout","dndDropEffectWorkaround","dndDragTypeWorkaround",function(d,b,c,a){return function(g,f,e){f.attr("draggable","true");if(e.dndDisableIf){g.$watch(e.dndDisableIf,function(h){f.attr("draggable",!h)})}f.on("dragstart",function(h){h=h.originalEvent||h;h.dataTransfer.setData("Text",angular.toJson(g.$eval(e.dndDraggable)));h.dataTransfer.effectAllowed=e.dndEffectAllowed||"move";f.addClass("dndDragging");b(function(){f.addClass("dndDraggingSource")},0);c.dropEffect="none";a.isDragging=true;a.dragType=e.dndType?g.$eval(e.dndType):undefined;d(e.dndDragstart)(g,{event:h});h.stopPropagation()});f.on("dragend",function(h){h=h.originalEvent||h;var i=c.dropEffect;g.$apply(function(){switch(i){case"move":d(e.dndMoved)(g,{event:h});break;case"copy":d(e.dndCopied)(g,{event:h});break}});f.removeClass("dndDragging");f.removeClass("dndDraggingSource");a.isDragging=false;h.stopPropagation()});f.on("click",function(h){h=h.originalEvent||h;g.$apply(function(){d(e.dndSelected)(g,{event:h})});if(g.vulpejs&&g.vulpejs.now&&g.vulpejs.now.uiEventPropagationForce){delete g.vulpejs.now.uiEventPropagationForce;return}h.stopPropagation()});f.on("selectstart",function(){if(this.dragDrop){this.dragDrop()}return false})}}]).directive("dndList",["$parse","$timeout","dndDropEffectWorkaround","dndDragTypeWorkaround",function(d,b,c,a){return function(r,i,j){var o=angular.element("<li class='dndPlaceholder'></li>");var g=o[0];var h=i[0];var e=j.dndHorizontalList&&r.$eval(j.dndHorizontalList);var q=j.dndExternalSources&&r.$eval(j.dndExternalSources);i.on("dragover",function(s){s=s.originalEvent||s;if(!l(s)){return true}if(g.parentNode!=h){i.append(o)}if(s.target!==h){var t=s.target;while(t.parentNode!==h&&t.parentNode){t=t.parentNode}if(t.parentNode===h&&t!==g){if(n(s,t)){h.insertBefore(g,t)}else{h.insertBefore(g,t.nextSibling)}}}else{if(n(s,g,true)){while(g.previousElementSibling&&(n(s,g.previousElementSibling,true)||g.previousElementSibling.offsetHeight===0)){h.insertBefore(g,g.previousElementSibling)}}else{while(g.nextElementSibling&&!n(s,g.nextElementSibling,true)){h.insertBefore(g,g.nextElementSibling.nextElementSibling)}}}if(j.dndDragover&&!f(j.dndDragover,s)){return k()}i.addClass("dndDragover");s.preventDefault();s.stopPropagation();return false});i.on("drop",function(s){s=s.originalEvent||s;if(!l(s)){return true}s.preventDefault();var t=s.dataTransfer.getData("Text")||s.dataTransfer.getData("text/plain");var w;try{w=JSON.parse(t)}catch(u){return k()}if(j.dndDrop){w=f(j.dndDrop,s,w);if(!w){return k()}}var v=r.$eval(j.dndList);r.$apply(function(){v.splice(p(),0,w)});if(s.dataTransfer.dropEffect==="none"){if(s.dataTransfer.effectAllowed==="copy"||s.dataTransfer.effectAllowed==="move"){c.dropEffect=s.dataTransfer.effectAllowed}else{c.dropEffect=s.ctrlKey?"copy":"move"}}else{c.dropEffect=s.dataTransfer.dropEffect}k();s.stopPropagation();return false});i.on("dragleave",function(s){s=s.originalEvent||s;i.removeClass("dndDragover");b(function(){if(!i.hasClass("dndDragover")){o.remove()}},100)});function n(w,x,s){var t=e?(w.offsetX||w.layerX):(w.offsetY||w.layerY);var v=e?x.offsetWidth:x.offsetHeight;var u=e?x.offsetLeft:x.offsetTop;u=s?u:0;return t<u+v/2}function p(){return Array.prototype.indexOf.call(h.children,g)}function l(s){if(!a.isDragging&&!q){return false}if(!m(s.dataTransfer.types)){return false}if(j.dndAllowedTypes&&a.isDragging){var t=r.$eval(j.dndAllowedTypes);if(angular.isArray(t)&&t.indexOf(a.dragType)===-1){return false}}if(j.dndDisableIf&&r.$eval(j.dndDisableIf)){return false}return true}function k(){o.remove();i.removeClass("dndDragover");return true}function f(u,t,s){return d(u)(r,{event:t,index:p(),item:s||undefined,external:!a.isDragging,type:a.isDragging?a.dragType:undefined})}function m(t){if(!t){return true}for(var s=0;s<t.length;s++){if(t[s]==="Text"||t[s]==="text/plain"){return true}}return false}}}]).factory("dndDragTypeWorkaround",function(){return{}}).factory("dndDropEffectWorkaround",function(){return{}});