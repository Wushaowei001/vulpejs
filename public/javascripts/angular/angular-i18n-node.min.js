!function(){"use strict";var e=angular.module("i18n",[]);e.provider("i18n",function(){var e=this;e.objectNotation=".",e.setObjectNotation=function(n){e.objectNotation=n},e.$get=["$rootScope","$http","$q",function(n,t,i){var o=function(){this._localeLoadedDeferred=i.defer(),this._deferredStack=[],this.loaded=!1,this.init=function(e){if(e!=this.userLanguage){this._localeLoadedDeferred&&this._deferredStack.push(this._localeLoadedDeferred),this._localeLoadedDeferred=i.defer(),this.loaded=!1,this.userLanguage=e;var o=this;t({method:"get",url:vulpe.ng.rootContext+"/i18n/"+e,cache:!0}).success(function(e){for(n.i18n=e,o.loaded=!0,o._localeLoadedDeferred.resolve(n.i18n);o._deferredStack.length;)o._deferredStack.pop().resolve(n.i18n);n.$broadcast("LOCALE_UPDATED")})}return this._localeLoadedDeferred.promise},this.i18n=function(){var e=i.defer(),n=this;return this.ensureLocaleIsLoaded().then(function(){e.resolve(n)}),e.promise},this.ensureLocaleIsLoaded=function(){return this._localeLoadedDeferred.promise},this.getTranslationObject=function(t){var i=t.split(e.objectNotation).reduce(function(e,n){return e&&e.hasOwnProperty(n)?e[n]:null},n.i18n);return i},this.__=function(e){if(!n.i18n)return e;var i=n.i18n[e]||this.getTranslationObject(e);return i||(i=e,n.i18n[e]=i,t.get(vulpe.ng.rootContext+"/i18n/"+this.userLanguage+"/"+encodeURIComponent(e)).success(function(t){n.i18n[e]=t})),arguments.length>1&&"function"==typeof vsprintf&&(i=vsprintf(i,Array.prototype.slice.call(arguments,1))),i},this.__n=function(e,i,o){if(!n.i18n)return i;var r=n.i18n[i]||this.getTranslationObject(i);if(!r){o||(o=i),r={one:i,other:o},n.i18n[i]=r;var c=vulpe.ng.rootContext+"/i18n/"+this.userLanguage+"/"+encodeURIComponent(i)+"?plural="+encodeURIComponent(o)+"&count="+encodeURIComponent(e);t.get(c).success(function(e){n.i18n[i]=e})}return r=1==e?r.one:r.other,"function"==typeof vsprintf&&(r=vsprintf(r,[e])),r}};return new o}]}),e.directive("i18n",["i18n","$rootScope",function(e,n){return{restrict:"A",link:function(t,i,o){function r(n,t){n=n||o.i18n,t=t||c(),i.text(void 0===t?e.__(n):e.__n(t,n))}function c(){var e=o.count;return e&&parseInt(e)}o.$observe("i18n",function(e){r(e)}),n.$on("LOCALE_UPDATED",function(){r()})}}}]),e.directive("i18nLocale",["i18n","$rootScope",function(e,n){return{restrict:"A",link:function(t,i,o){o.$observe("i18nLocale",function(n){e.init(n)}),n.$watch("i18nLocale",function(n,t){n&&n!=t&&e.init(n)})}}}]),e.filter("i18n",["i18n",function(e){function n(e){return!isNaN(parseFloat(e))&&isFinite(e)}var t=function(t){return n(t)?e.__n.apply(e,arguments):e.__.apply(e,arguments)};return t.$stateful=!0,t}])}();